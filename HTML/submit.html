<!DOCTYPE html>
<html lang ="pt-BR">
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no" />
        <meta name="description" content="" />
        <meta name="author" content="" />
        <title>Submissão de dados</title>
        <link rel="icon" type="image/x-icon" href="../assets/mac.ico" /> <!-- colocar ícone na pag-->
        <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css">
        <!-- Core theme CSS (includes Bootstrap)-->
        <link href="../css/submit.css" rel="stylesheet" />
        <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/js/bootstrap.bundle.min.js"></script>       
        <script src="../js/add-script.js"></script>
        
    </head>
    <body id="page1">
        <!-- Navigation-->
        <nav class="navbar navbar-expand-lg navbar-dark bg-dark fixed-top" id="mainNav">
            <div class="container px-4">
                
                <div class="search1">
                    
                    <input style="left: 0%;" id="search1" type="text" name="search" placeholder="Search..">
                    <button style="left: 0%;"><i class="bi bi-search"></i></button>
                </div>

                <!--<a class="navbar-brand" href="#page-top">Start Bootstrap</a>-->

                <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarResponsive" aria-controls="navbarResponsive" aria-expanded="false" aria-label="Toggle navigation" id="navbarToggleBtn"><span class="navbar-toggler-icon"></span></button>
                <div class="collapse navbar-collapse" id="navbarResponsive">
                    <ul class="navbar-nav ms-auto">

                        <li class="nav-item"><a class="nav-link" href="../index.html" onclick=closeNavbar()>Home</a></li>
                        <li class="nav-item"><a class="nav-link" href="../index.html#last-issues" onclick=closeNavbar()>Últimos Artigos</a></li>
                        <li class="nav-item"><a class="nav-link" href="../index.html#contact" onclick=closeNavbar()>Contatos</a></li>
                        <li class="nav-item"><a class="nav-link" href="consulta.php" onclick=closeNavbar()>Consulta</a></li>
                        <li class="nav-item"><a class="nav-link" href="submit.html">Submissão de dados</a></li>
                        <li class="nav-item"><a class="nav-link" href="#" onclick= "openLoginDialog(); closeNavbar()" >Login</a></li> <!-- deixar o login como caixa de diálogo-->
                        <li class="nav-item"><a class="nav-link" href="novo-user.html" onclick=closeNavbar()>Sing in </a></li> <!-- registro mais informações além disso pode ser em uma pagina nova-->
                    </ul>
                </div>
            </div>
        </nav>



 <!-- LOGIN POR CAIXA DE DIALOGO-->                     
 <div id="loginDialogOverlay">

    <div id="loginDialog">
        
        <img src="../assets/avatar.jpeg" alt="Avatar" class="avatar">
    </br>
</br>
        <h2>Login</h2></br>
        <form action="../PHP/login.php" method="post">
            
            <label for="username">Nome:</label></br>
            <input type="text" id="nome" name="nome" required autofocus>
        </br>
            <label for="password">Senha:</label></br>
            <input type="password" id="senha" name="senha" required></br>

           <button class="lgbttn" type="submit">Login</button></br>
                                        
</form>
            
<button class="lgbttn" onclick="closeLoginDialog()">Fechar</button>

</div>
</div>

        <header class="bg-primary bg-gradient text-white">
            <div class="container px-4 text-center">
                <h1 class="fw-bolder"> ProxyMar Data Base</h1>
                <p class="lead"> Antes de submeter os dados por favor certifique-se: </p>
                <ul id="info"> Lista de informaçãoes pré-submissão</ul>
                <li> .. </li>
                <li> .. </li>
                <li> Garanta que seus dados possam ser interpretado por outra pessoa </li>
                <li> Arquivos aceitos: XLS, PDF? </li> 
</div>
        </header></br>

<!-- PRIMEIRA PAGINA -->

<form id="forms" method="post" action="../PHP/submit-DADOS2.php" enctype="multipart/form-data" style="position: relative">
   
   
    <!-- campo invisivel para recuperar os valores finais -->
    <input type="hidden" id="secaoAtual1" name="secaoAtual1" value="1">

    <!-- autor correspondente-->
    
    <div id="section1" class="form-section active">
        <h1 style="text-align: center;"> Formulário para Submissão: </h1></br>

        <label id="autor" for="autor"> *Identificação do Correspondente:</label></br>
        <input type="text" id="correspondente" name="correspondente" style="width: 49%;" placeholder="Nome Completo">
        <input type="email" id="email" name="email" style="width: 49%;" placeholder="E-mail do correspondente (ex: xxxxx@mail.com)">
    </br>
</br>

<div id="tipoTrabalho" class="clearfix">
    <div class="coluna">
        <label for="tipoTrabalho"> Tipo de trabalho:</label><br>
        <select id="tipoTrabalhoSelecao" name="tipoTrabalho">
            <option value=""> --- </option>
            <option value="Artigo"> Artigo </option>
            <option value="Tese de Doutorado"> Tese de Doutorado </option>
            <option value="Dissertação de Mestrado"> Dissertação de Mestrado </option>
            <option value="Relatório"> Relatórios </option>
            <option value="Resumo"> Resumo </option>
            <option value="Outro"> Outro </option>
        </select><br><br>
    </div>


    <div id="armazenamento" class="coluna">
        <label for='armazenamento'> Como deseja armazenar os dados?</label><br>
        <select id="armazenamentoSelecao" name="armazenamento">
            <option value="">---</option>
            <option value="Público"> Público</option>
            <option value="Privado"> Privado </option>
        </select></br><br>
    </div></div>



<div class="termo">
   
    <input type="checkbox" id="termo" name="termo" value="term">
    <label for="termo"> Li e concordo com os termos sobre o uso dos dados</PDF><a href="javascript:abrirPDF()"> Clique aqui para ler</a></label>
     
</div></br>


<label  for="titulo"></label> *Título/ Title:</label></br>
<input id="titulo" type="text" name="titulo" style="width: 100%;" placeholder="Título do trabalho em Inglês OU Português" >
</br>
</br>


<!-- coAutores -->
<h3 id="coAutores"> Adicionar Autores e Co-Atores:</h3></br>      
<div id="autoresContainer">
    <!-- Aqui serão adicionados os campos de coautores dinamicamente -->
</div>
<br>
<div id="autor-button">
    <button style="left: 1%; position: absolute;" class="button" type="button" onclick="adicionarAutor()">Adicionar Autor</button>
    <button type="button" style="position:absolute; left: 50%; transform: translateX(-50%);" class="button" onclick="deletarAutor()">Remover último Co-autor</button>
    <button type="button" style="right: 2%; position:absolute;" class="button" onclick="removerTODOSAutores()">Remover todas as linhas </button>
</div>
</br>
</br>
        
    <div>
        <div>
          <label for="periodico" >Nome do Periódico:</label></br>
        <input type="text" id="periodico" name="periodico" style="width: 35%;"  placeholder="Nome do periódico onde o trabalho está publicado">
    </div>
</br>    
    <label for="linkart"  > Link para o Artigo:</label></br>
        <input type="text" id="linkart" name="linkart" style="width: 35%;"  placeholder="endereço URL para artigo/revista">
    </div>

</br>
        
    <div>    
    <label for="doi"> DOI:</label>/<br>
    <input id="doi" name="doi" type="text" style="width: 35%; display: flex;" placeholder="XXXX/XX">    
    </div>
</br>

<div>
        <label  for="data1"> Data da publicação:</label></br>
        <input id="data1" type="date" name="data1" style="width: 150px;">
</div></br>
<div>
    <label for="keywords" > Palavras-Chave/Keywords:</label></br>
    <input type="text" id="keywords" name="keywords" style="width: 85%;"  placeholder="3 a 5 palavras-chave"></br></br>
</div>   
<div>
    <label for="referencia" > Referência conforme a ABNT:</label></br>
    <textarea type="text" id="referencia" name="referencia"  maxlength="1500" rows="5" cols="10" placeholder="SOBRENOME, nome abreviado. Título do artigo. Título da Revista, (abreviado ou não) Local de Publicação, Número do Volume, Número do Fascículo, Páginas inicial-final, mês e ano."></textarea></br></br>
</div>
    
    <div>
        <button class="button" type="button" style="right: 1%;position:absolute; bottom:1%;" onclick="proximaPagina()"> Avançar </button></div>
    </div>


</div>





    <!-- SEGUNDA PAGINA-->
<div id="section2" class="form-section">

    <!-- campo invisivel para recuperar os valores finais -->
    <input type="hidden" id="secaoAtual2" name="secaoAtual2" value="2">


        <h1 style="text-align: center;"> Informação dos dados a serem submetidos: </h1></br>
   
<div id="coord">
    <h3 for="lat-long"> Adicione as Coordenadas de CADA ponto de coleta:<a title="VER MODELO" href="javascript:abrirPDF()"  style="color: red;" class="bi bi-question-square-fill"></a></h3>
        
    <div id="coordenadas" >
      <!-- os pontos de coletas serão inseridos aqui -->
        
    </div>
    <div id="coord-bttn"></br>
        <button style="left: 1%; position: absolute;" class="button" type="button" onclick="adicionarCoordenadas() ">Adicionar Ponto</button>
        <button type="button" style="position:absolute; left: 50%; transform: translateX(-50%);" class="button" onclick="deletarCoordenadas() ">Remover Ponto</button>
        <button type="button" style="right: 2%; position:absolute;" class="button" onclick="removerTODAScoordenadas()">Remover todos os Pontos</button>
    
    </div>
</div>
</br></br>
</br></br>
<div id="proxys">
    <h2> Proxies utilizados:</h2>
    <!-- depois deixar de 2 em 2 alinhado -->
<input type="checkbox" id="TSM" name="TSM" value="TSM">
<label for="TSM" style="margin-right: 2%; ">TSM ( Temperatura da superficie do Mar)</label>

<input type="checkbox" id="PP" name="PP" value="PP">
<label for="PP" style="margin-right: 2%;">Produtividade</label>

<input type="checkbox" id="circulacao" name="circulacao" value="circulacao">
<label for="circulacao" style="margin-right: 2%;">Circulação Oceânica</label>

<input type="checkbox" id="org" name="org" value="org">
<label for="org" style="margin-right: 2%;">Marcadores Orgânicos</label>

<input type="checkbox" id="inorg" name="inorg" value="inorg">
<label for="inorg" style="margin-right: 2%;">Marcadores Inorgânicos</label>

<input type="checkbox" id="foramplan" name="foramplan" value="foramplan">
<label for="foramplan" style="margin-right: 2%;">Foraminíferos Planctônicos</label>

<input type="checkbox" id="forambent" name="forambent" value="forambent">
<label for="forambent" style="margin-right: 2%;">Foraminíferos Bentônnicos</label>

<input type="checkbox" id="sealev" name="sealev" value="sealev">
<label for="sealev" style="margin-right: 2%;">Nível do Mar</label>

<input type="checkbox" id="co2atm" name="co2atm" value="co2atm">
<label for="co2atm" style="margin-right: 2%;">CO<sub>2</sub> Atmosférico</label>

<input type="checkbox" id="cobveg" name="cobveg" value="cobveg">
<label for="cobveg" style="margin-right: 2%;">Cobertura Vegetal</label>

<input type="checkbox" id="rainfall" name="rainfall" value="rainfall">
<label for="rainfall" style="margin-right: 2%;">Precipitação</label>

<input type="checkbox" id="stratg" name="stratg" value="stratg">
<label for="stratg" style="margin-right: 2%;">Estratigrafia</label></br></br>


<input  type="text" id="outroProx" name="outroProx" placeholder="Outro" style="width: 30%;">
</br>
</div>
</br>
</br>

<div id="equip-coleata">
    <h2> Equipamentos de Coleta:</h2>

<input type="checkbox" id="multcorer" name="multcorer" value="multcorer">
<label for="multcorer" style="margin-right: 2%; ">MultiCorer</label>

<input type="checkbox" id="piston" name="piston" value="piston">
<label for="PP" style="margin-right: 2%;">Piston Corer</label>

<input type="checkbox" id="gravcorer" name="gravcorer" value="gravcorer">
<label for="gravcorer" style="margin-right: 2%;">Gravity Corer</label>

<input type="checkbox" id="drilli" name="drilli" value="drilli">
<label for="drilli" style="margin-right: 2%;">Drilling</label>

<input type="checkbox" id="gboxcorer" name="gboxcorer" value="gboxcorer">
<label for="gboxcorer" style="margin-right: 2%;"> Giant box corer</label>

<input type="checkbox" id="compcorer" name="compcorer" value="compcorer">
<label for="compcorer" style="margin-right: 2%;">Composite Corer</label>

<input type="checkbox" id="boxcorer" name="boxcorer" value="boxcorer">
<label for="boxcorer" style="margin-right: 2%;">Box Corer</label>

<input type="checkbox" id="corer" name="corer" value="corer">
<label for="corer" style="margin-right: 2%;">Corer</label></br></br>

<input type="text" id="outroEqui" name="outroEqui" placeholder="Outro" style="width: 30%;">


</br>
</div>
</br>
</br>

        <h2> Descrição dos dados e Métodos: </h2></br>
        <label  form="caract"> Caracteristicas dos dados inseridos: </label></br>
        <textarea type="text" id="caract" name="caract"  maxlength="1500" rows="10" cols="150" placeholder="Conte um pouco como sobre as caracteriscas do seu dado. Ex: Tabela com granulometria, grau de seleção etc (max 1500 caracteres)"></textarea>
    </br></br>


    <label  form="metut"> Métodos Utilizados: </label></br>
    <textarea type="text" id="metut" name="metut"  maxlength="1500" rows="10" cols="150" placeholder=" Conte brevemente como foi feito, e os equipamentos Utilizados"></textarea>
</br></br>



<h2> Adicione o arquivo CSV (separado por virgula): </h2>
<a title="VER MODELO" href="javascript:abrirPDF()"  style="color: green; margin-right: 2%; font-size: 45px;" class="bi bi-filetype-csv"></a>
<input id="refef" type="file" name="tabelaDado" style="width: 30%;" unique><br><br><br>
    
    </br></br></br>           
    
     
        <button class="button" type="button" style="position: absolute; left: 1%; bottom: 1%;" onclick="paginaAnterior()">Anterior</button>
        <button class="button" type="button" style="position: absolute; right: 1%; bottom: 1%;" onclick="proximaPagina();exibirResumo()">Avançar</button>

</div>
</br></br>
<!-- terceira PAGINA -->
<div id="section3" class="form-section">
    <h1>  Confirme todas as informações: </h1>
    <div id="summary-1">
       
    </div>

</br>
</br>    
    <button class="button" type="button" style="position: absolute; left: 1%; bottom: 1%;" onclick="paginaAnterior()">Anterior</button>
    <button class="button" type="button" style="position: absolute; right: 1%; bottom: 1%;" onclick="proximaPagina();exibirDADOS()">Avançar</button>
    


</div>




<!-- quarta página - PONTOS INSERIDOS-->

<div id="section4" class="form-section">
    <h1>  Confirme os pontos inseridos: </h1>
    <div id="summary-2">
       
    </div>

     
    <button class="button" type="button" style="position: absolute; left: 1%; bottom: 1%;" onclick="paginaAnterior()">Anterior</button> 
    <button class="button" type="submit" style="position: absolute; right: 1%; bottom: 1%;"> Submeter</button>

</br>
</br>
</div>

</form>




<form action="../PHP/teste-conexao-postgre.php" method="post">

    <button class="button" type="submit"> CONSULTAR CONEXÂO COM BANCO</button>
</form>
</br>
</br>
<!-- rodapé da página-->


<footer class="py-5 bg-dark" style="position: relative;">

    <div class="social">
    <p class="text-white">Copyright &copy; Italo Paladino 2024</p>
</br>
</br>    
    <a href="https://www.instagram.com/proxymar_iousp/" target="_blank" class="bi bi-instagram"></a>
    <a href="https://sites.usp.br/proxymar/sobre//" target="_blank" class="bi bi-globe2"> </a>
    <a href="mailto:italopaladino22@gmail.com" target="_blank" class="bi bi-envelope"> </a>      
   </div>
    
 
      
</footer>
<script>
    // Função genérica para autocomplete
    function autocomplete(inputField, phpScript) {
        var inputValue = inputField.value.trim();
        var inputId = inputField.id;

        if (inputValue.length < 3) {
            return;
        }

        var xhr = new XMLHttpRequest();
        xhr.onreadystatechange = function() {
            if (xhr.readyState === XMLHttpRequest.DONE) {
                if (xhr.status === 200) {
                    try {
                        var suggestions = JSON.parse(xhr.responseText);
                        showSuggestions(inputField, suggestions);
                    } catch (e) {
                        console.error('Erro ao processar JSON:', e);
                    }
                } else {
                    console.error('Erro na requisição: ' + xhr.status + ' - ' + xhr.statusText);
                }
            }
        };

        xhr.open("GET", phpScript + "?q=" + encodeURIComponent(inputValue), true);
        xhr.send();
    }

    // Função para exibir sugestões
    function showSuggestions(inputField, suggestions) {
        var inputId = inputField.id;
        var autocompleteContainerId = inputId + "-autocomplete";

        var autocompleteContainer = document.getElementById(autocompleteContainerId);
        if (!autocompleteContainer) {
            autocompleteContainer = createAutocompleteContainer(inputId);
        } else {
            autocompleteContainer.innerHTML = '';
        }

        var ul = document.createElement('ul');
        ul.classList.add('autocomplete-list');

        var selectedIndex = -1;

        suggestions.forEach(function(suggestion, index) {
            var li = document.createElement('li');
            li.textContent = suggestion;
            li.addEventListener("click", function() {
                inputField.value = suggestion;
                autocompleteContainer.style.display = 'none';
            });

            ul.appendChild(li);
        });

        autocompleteContainer.appendChild(ul);
        autocompleteContainer.style.display = 'block';

        function updateSelection() {
        var lis = ul.getElementsByTagName('li');
        for (var i = 0; i < lis.length; i++) {
            lis[i].classList.remove('selected');
        }
        if (selectedIndex !== -1) {
            lis[selectedIndex].classList.add('selected');
        }
    }

    inputField.addEventListener("keydown", function(event) {
        var lis = ul.getElementsByTagName('li');
        if (event.key === "ArrowDown") {
            selectedIndex = Math.min(selectedIndex + 1, suggestions.length - 1);
            updateSelection();
        } else if (event.key === "ArrowUp") {
            selectedIndex = Math.max(selectedIndex - 1, 0);
            updateSelection();
        } else if (event.key === "Enter" && selectedIndex !== -1) {
            event.preventDefault();
            inputField.value = suggestions[selectedIndex];
            autocompleteContainer.style.display = 'none';
        } else if (event.key === "Escape") {
            autocompleteContainer.style.display = 'none';
        } else if (event.key === "Tab") {
            autocompleteContainer.style.display = 'none';
        }
    });
}
    // Função para criar o contêiner de autocomplete
    function createAutocompleteContainer(inputId) {
        var inputElement = document.getElementById(inputId);
        var autocompleteContainerId = inputId + "-autocomplete";

        var autocompleteContainer = document.createElement("div");
        autocompleteContainer.id = autocompleteContainerId;
        autocompleteContainer.className = "autocomplete-container";

        inputElement.parentNode.insertBefore(autocompleteContainer, inputElement.nextSibling);

        document.addEventListener("click", function(event) {
            if (!autocompleteContainer.contains(event.target)) {
                autocompleteContainer.style.display = 'none';
            }
        });

        return autocompleteContainer;
    }

    // Adicionar evento aos campos de autor existentes
    document.querySelectorAll('.autor').forEach(function(inputField) {
        inputField.addEventListener('input', function() {
            autocomplete(this, "../PHP/busca_autor.php");
        });
    });

    // Adicionar evento aos campos de filiação existentes
    document.querySelectorAll('.filiacao').forEach(function(inputField) {
        inputField.addEventListener('input', function() {
            autocomplete(this, "../PHP/busca_fili.php");
        });
    });
</script>

</body>      
</html>